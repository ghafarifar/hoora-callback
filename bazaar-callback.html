<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Redirecting to Hoora...</title>
  <script>
    window.onload = function() {
      const urlParams = new URLSearchParams(window.location.search);
      const code = urlParams.get('code');
      const state = urlParams.get('state');

      if (code) {
        // هماهنگ با intent-filter فعلی: host = bazaar-callback
        const appUrl = `hoora://bazaar-callback?code=${encodeURIComponent(code)}&state=${encodeURIComponent(state || '')}`;

        // تلاش برای redirect خودکار
        window.location.href = appUrl;

        // در صورت مسدود شدن، لینک قابل کلیک به کاربر نمایش داده می‌شود
        const link = document.getElementById('open-app');
        link.href = appUrl;
        link.style.display = 'inline-block';
        document.getElementById('message').innerText = 'Trying to open the Hoora app. If it does not open, please click the button below.';
      } else {
        const error = urlParams.get('error');
        document.getElementById('message').innerText = `An error occurred: ${error || 'Unknown error'}.`;
      }
    };
  </script>
  <style>
    #open-app { display:none; margin-top: 16px; padding:8px 12px; background:#1976d2; color:white; text-decoration:none; border-radius:4px; }
  </style>
</head>
<body>
  <h3 id="message">Please wait, redirecting...</h3>
  <a id="open-app" href="#">Open Hoora app</a>
</body>
</html>
